from collections import OrderedDict

Import('env')

penv = env.Clone()

sysroot = Dir('../sysroot/sysroot')
toolchain = Dir('../sysroot/toolchain')

penv['SYSROOT'] = sysroot
penv['CROSS_COMPILE'] = toolchain.abspath + '/bin/arm-linux-gnueabihf-'

penv.PrependENVPath('PATH', toolchain.abspath + '/bin:')
penv['ENV']['SYSROOT'] = sysroot.abspath

penv_gst = penv.Clone()

def package_walk(name, result, seen):
    if name in seen:
        return
    seen.add(name)
    p = SConscript(name + '/SConscript', 'sysroot penv penv_gst')
    for r in p['requires']:
        package_walk(r, result, seen)
    result[name] = p

packages = OrderedDict()
for p in ['qmlrss', 'gstreamer']:
    package_walk(p, packages, set())
print('Enabled packages:', ', '.join(packages.keys()))


SConscript('../sysroot/SConscript', 'env packages')

Return('packages')
