Import('env')

package = {
    'requires': ['qt'],
    'sysroot_debs': [],
    'root_debs': [],
    'target': File('qmldemo.tar.gz'),
}

prefix = '/opt/qt'
stage = Dir('stage/')

env.Command([package['target']], ['qmldemo.service', 'qmldemo.qml'], [

    'rm -rf --one-file-system ${STAGE}',

    'mkdir -p ${STAGE}/etc/systemd/system',
    'mkdir -p ${STAGE}/${PREFIX}/bin/',
    'cp ${SOURCES[0]} ${STAGE}/etc/systemd/system/',
    'cp ${SOURCES[1]} ${STAGE}/${PREFIX}/bin/',

    'tar -C ${STAGE} -czf ${TARGETS[0]} .',

], PREFIX=prefix, STAGE=stage)

Return('package')


######

install = """
	tar -xf qmldemo.tar.gz -C $(DESTDIR)
	$(MYCHROOT) $(DESTDIR) /bin/systemctl reenable qmldemo.service
"""